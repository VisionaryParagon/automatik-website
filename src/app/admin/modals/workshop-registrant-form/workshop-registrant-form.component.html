<div class="d-flex justify-content-between mb-3">
  <div>
    <h2 mat-dialog-title *ngIf="!edit">New Registrant</h2>
    <h2 mat-dialog-title *ngIf="edit">Editing {{ registrant.first_name }} {{ registrant.last_name }}</h2>
    <p class="mb-0" *ngIf="edit">Registration&nbsp;Status:&nbsp;<strong [class.text-success]="registrant.reg_status === 'Registered'" [class.text-danger]="registrant.reg_status !== 'Registered'">{{ registrant.reg_status }}</strong>&nbsp;//
      Payment&nbsp;Status:&nbsp;<strong [class.text-success]="registrant.pmt_status === 'Paid'" [class.text-danger]="registrant.pmt_status !== 'Paid'">{{ registrant.pmt_status }}</strong>&nbsp;//
      Amount:&nbsp;<strong [class.text-success]="registrant.pmt_status === 'Paid'" [class.text-danger]="registrant.pmt_status !== 'Paid'">{{ registrant.price | currency }}</strong></p>
  </div>
  <button class="mat-dialog-close" (click)="closeDialog()"><fa-icon [icon]="['fas', 'times']"></fa-icon></button>
</div>

<form #workshopRegForm="ngForm" novalidate>
  <mat-dialog-content>
    <div class="dialogScroll">
      <div *ngIf="!success">
        <div class="inputGroup" [class.nope]="workshop.errors && (workshop.touched || submitted)">
          <label for="workshop">Workshop*</label>
          <select id="workshop" name="workshop" #workshop="ngModel" required [(ngModel)]="registrant.workshop" (ngModelChange)="updateWorkshop(workshop.value); hideError()">
            <option [value]="anyVal" selected disabled>Select a Workshop</option>
            <option *ngFor="let workshop of workshops" [value]="workshop.title">{{ workshop.title }}</option>
          </select>
          <fa-icon [icon]="['fas', 'caret-down']"></fa-icon>
          <div class="errorMsg" [@topDown]="true" *ngIf="workshop.errors && (workshop.touched || submitted)">
            <p *ngIf="workshop.errors.required">Please select an option</p>
          </div>
        </div>

        <div class="inputGroup" [class.nope]="workshop_date.errors && (workshop_date.touched || submitted)">
          <label for="workshop_date">Date*</label>
          <select id="workshop_date" name="workshop_date" #workshop_date="ngModel" required [disabled]="!registrant.workshop" [(ngModel)]="registrant.workshop_date" (ngModelChange)="hideError()">
            <option [value]="anyVal" selected disabled>Select a Date</option>
            <option *ngFor="let date of dates" [value]="date">{{ date | date:'fullDate' }}</option>
          </select>
          <fa-icon [icon]="['fas', 'caret-down']"></fa-icon>
          <div class="errorMsg" [@topDown]="true" *ngIf="workshop_date.errors && (workshop_date.touched || submitted)">
            <p *ngIf="workshop_date.errors.required">Please select an option</p>
          </div>
        </div>

        <div class="inputGroup" [class.nope]="email.errors && (email.touched || submitted)">
          <label for="email">Email Address*</label>
          <input type="text" id="email" name="email" #email="ngModel" autocomplete="off" required pattern="^[^\s@]+@[^\s@]+\.[^\s@]{2,}$" [(ngModel)]="registrant.email" (ngModelChange)="hideError()">
          <div class="errorMsg" [@topDown]="true" *ngIf="email.errors && (email.touched || submitted)">
            <p *ngIf="email.errors.required">Email Address is required</p>
            <p *ngIf="email.errors.pattern">Email Address is invalid</p>
          </div>
        </div>

        <div class="inputGroup" [class.nope]="(first_name.errors && (first_name.touched || submitted)) || (last_name.errors && (last_name.touched || submitted))">
          <label for="first_name">Name*</label>
          <div class="row">
            <div class="col-12 col-md-6">
              <input type="text" id="first_name" name="first_name" #first_name="ngModel" placeholder="First" autocomplete="off" required pattern="^[A-z-.]+$" [(ngModel)]="registrant.first_name" (ngModelChange)="hideError()">
              <div class="errorMsg" [@topDown]="true" *ngIf="first_name.errors && (first_name.touched || submitted)">
                <p *ngIf="first_name.errors.required">First Name is required</p>
                <p *ngIf="first_name.errors.pattern">Numbers and special characters are not allowed</p>
              </div>
            </div>

            <div class="col-12 col-md-6">
              <input type="text" id="last_name" name="last_name" #last_name="ngModel" placeholder="Last" autocomplete="off" required pattern="^[A-z-.]+$" [(ngModel)]="registrant.last_name" (ngModelChange)="hideError()">
              <div class="errorMsg" [@topDown]="true" *ngIf="last_name.errors && (last_name.touched || submitted)">
                <p *ngIf="last_name.errors.required">Last Name is required</p>
                <p *ngIf="last_name.errors.pattern">Numbers and special characters are not allowed</p>
              </div>
            </div>
          </div>
        </div>

        <div class="inputGroup" [class.nope]="address.errors && (address.touched || submitted)">
          <label for="address">Billing Address*</label>
          <div class="row">
            <div class="col-12 col-md-8">
              <input type="text" id="address" name="address" #address="ngModel" placeholder="Street/PO Box" autocomplete="off" required [(ngModel)]="registrant.address" (ngModelChange)="hideError()">
            </div>

            <div class="col-12 col-md-4">
              <input type="text" id="address_2" name="address_2" #address_2="ngModel" placeholder="Apt/Unit" autocomplete="off" [(ngModel)]="registrant.address_2" (ngModelChange)="hideError()">
            </div>
          </div>
          <div class="errorMsg" [@topDown]="true" *ngIf="address.errors && (address.touched || submitted)">
            <p *ngIf="address.errors.required">Address is required</p>
          </div>
        </div>

        <div class="row">
          <div class="col-12 col-md-4">
            <div class="inputGroup mb-3 mt-0 m-md-0" [class.nope]="city.errors && (city.touched || submitted)">
              <label for="city">City*</label>
              <input type="text" id="city" name="city" #city="ngModel" autocomplete="off" required [(ngModel)]="registrant.city" (ngModelChange)="hideError()">
              <div class="errorMsg" [@topDown]="true" *ngIf="city.errors && (city.touched || submitted)">
                <p *ngIf="city.errors.required">City is required</p>
              </div>
            </div>
          </div>

          <div class="col-12 col-md-4">
            <div class="inputGroup my-3 m-md-0" [class.nope]="state.errors && (state.touched || submitted)">
              <label for="state">State*</label>
              <input type="text" id="state" name="state" #state="ngModel" autocomplete="off" required [(ngModel)]="registrant.state" (ngModelChange)="hideError()">
              <div class="errorMsg" [@topDown]="true" *ngIf="state.errors && (state.touched || submitted)">
                <p *ngIf="state.errors.required">State is required</p>
              </div>
            </div>
          </div>

          <div class="col-12 col-md-4">
            <div class="inputGroup my-3 m-md-0" [class.nope]="zip.errors && (zip.touched || submitted)">
              <label for="zip">Zip Code*</label>
              <input type="text" id="zip" name="zip" #zip="ngModel" autocomplete="off" required [(ngModel)]="registrant.zip" (ngModelChange)="hideError()">
              <div class="errorMsg" [@topDown]="true" *ngIf="zip.errors && (zip.touched || submitted)">
                <p *ngIf="zip.errors.required">Zip Code is required</p>
              </div>
            </div>
          </div>
        </div>

        <div class="inputGroup" [class.nope]="cardError" *ngIf="!edit">
          <h4>Total: <strong>{{ registrant.price | currency }}</strong></h4>
  
          <label for="card-info">Card Info*</label>
          <div id="card-info" #cardInfo></div>

          <div id="card-errors" role="alert" [@topDown]="true" *ngIf="cardError">
            <p>{{ cardError }}</p>
          </div>
        </div>

        <div class="inputGroup" *ngIf="edit">
          <label for="eml">
            <input type="checkbox" id="eml" name="eml" #eml="ngModel" [(ngModel)]="resendEmail"> Send updated email confirmation
          </label>
        </div>

        <div class="text-center my-3">
          <p class="disclaimer">* Required field</p>

          <div class="errorMsg" [@topDown]="true" *ngIf="error.length">
            <p>{{ error }}</p>
          </div>
        </div>
      </div>

      <div [@fade]="true" *ngIf="success">
        <h4>Success!</h4>

        <p *ngIf="!edit">You have successfully registered <strong>{{ registrant.first_name }} {{ registrant.last_name }}</strong> for <strong>{{ registrant.workshop }}</strong> on <strong>{{ registrant.workshop_date | date:"fullDate" }}</strong>. A confirmation email with more details has been sent to <strong>{{ registrant.email }}</strong>.</p>

        <div *ngIf="edit">
          <p>You have successfully updated <strong>{{ registrant.first_name }} {{ registrant.last_name }}</strong>â€™s registration for <strong>{{ registrant.workshop }}</strong> on <strong>{{ registrant.workshop_date | date:"fullDate" }}</strong>.</p>

          <div *ngIf="resendEmail">
            <p *ngIf="emailSuccess">A confirmation email with more details has been sent to <strong>{{ registrant.email }}</strong>.</p>

            <p class="errorMsg" *ngIf="!emailSuccess">Confirmation email could not be sent to <strong>{{ registrant.email }}</strong>.</p>
          </div>
        </div>
      </div>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions>
    <button class="autoBtn secondary" *ngIf="!success" type="button" (click)="closeDialog()">Cancel</button>
    <button class="autoBtn" *ngIf="!success && !edit" [disabled]="loading" (click)="submit(workshopRegForm.valid)">
      <span *ngIf="!loading">Register</span>
      <span *ngIf="loading"><mat-spinner class="mx-auto" [diameter]="20" [strokeWidth]="3"></mat-spinner></span>
    </button>
    <button class="autoBtn" *ngIf="!success && edit" [disabled]="loading" (click)="update(workshopRegForm.valid)">
      <span *ngIf="!loading">Update</span>
      <span *ngIf="loading"><mat-spinner class="mx-auto" [diameter]="20" [strokeWidth]="3"></mat-spinner></span>
    </button>
    <button class="autoBtn" *ngIf="success" type="button" mat-dialog-close>Close</button>
  </mat-dialog-actions>
</form>
