<section [@fade]="true">
  <div class="container">
    <h1 class="text-center">Admin Assets</h1>

    <div class="row">
      <div class="col-12 col-md-6 order-md-last text-md-right">
        <button class="autoBtn my-3" (click)="addNew()">New Asset</button>
      </div>

      <div class="col-12 col-md-6 order-md-first adminFilter">
        <div class="inputGroup">
          <label for="search">
            <fa-icon [icon]="['fas', 'search']" size="lg" *ngIf="!filter.length"></fa-icon>
            <fa-icon [icon]="['fas', 'times']" size="lg" *ngIf="filter.length" (click)="clearFilter()"></fa-icon>
          </label>
          <input type="text" class="form-control" id="search" name="search" #search="ngModel" autocomplete="off" placeholder="Search" [(ngModel)]="filter" (ngModelChange)="updateFilter()">
        </div>
      </div>
    </div>

    <div *ngIf="!assetList.length && !error.length">
      <mat-spinner class="mx-auto my-5"></mat-spinner>
    </div>

    <div class="text-center" [@topDown]="true" *ngIf="error.length">
      <p>{{ error }}</p>
    </div>

    <div class="formDrawer" [@topDown]="true" *ngIf="new">
      <h3>Add New Asset</h3>

      <div *ngIf="!success">
        <form #imageForm="ngForm" novalidate>
          <div class="inputGroup" [class.nope]="invalid || rename || (asset.errors && (asset.touched || submitted))">
            <div class="custom-file">
              <input type="file" class="custom-file-input" id="asset" name="asset" #asset required (change)="setAssetData($event)">
              <label class="custom-file-label" for="asset">{{ assetName }}</label>
            </div>
            <div class="errorMsg" [@topDown]="true" *ngIf="asset.errors && (asset.touched || submitted)">
              <p *ngIf="asset.errors.required">Please choose an asset to upload</p>
            </div>
            <div class="errorMsg" [@topDown]="true" *ngIf="rename">
              <p>Please rename asset to meet standards and try again:</p>
              <ul>
                <li>All lowercase letters</li>
                <li>No special characters</li>
                <li>Dashes for spaces</li>
              </ul>
            </div>
            <div class="errorMsg" [@topDown]="true" *ngIf="invalid">
              <p>An asset already exists with this file name</p>
            </div>
          </div>

          <div class="inputGroup" [class.nope]="alt.errors && (alt.touched || submitted)" *ngIf="assetType === 'image'">
            <label for="alt">Alt Text</label>
            <input type="text" class="form-control" name="alt" #alt="ngModel" autocomplete="off" required [(ngModel)]="image.alt">
            <div class="errorMsg" [@topDown]="true" *ngIf="alt.errors && (alt.touched || submitted)">
              <p *ngIf="alt.errors.required">Alt Text is required</p>
            </div>
          </div>

          <div class="inputGroup" [class.nope]="invalidPoster || renamePoster || (poster.errors && (poster.touched || submitted))" *ngIf="assetType === 'video'">
            <div class="custom-file">
              <input type="file" class="custom-file-input" id="poster" name="poster" accept="image/*" #poster required (change)="setPosterData($event)">
              <label class="custom-file-label" for="poster">{{ posterName }}</label>
            </div>
            <div class="errorMsg" [@topDown]="true" *ngIf="poster.errors && (poster.touched || submitted)">
              <p *ngIf="poster.errors.required">Please choose a poster image to upload</p>
            </div>
            <div class="errorMsg" [@topDown]="true" *ngIf="renamePoster">
              <p>Please rename poster image to meet standards and try again:</p>
              <ul>
                <li>All lowercase letters</li>
                <li>No special characters</li>
                <li>Dashes for spaces</li>
              </ul>
            </div>
            <div class="errorMsg" [@topDown]="true" *ngIf="invalidPoster">
              <p>A poster image already exists with this file name</p>
            </div>
          </div>
  
          <div class="d-flex">
            <button class="autoBtn mx-0" [disabled]="loading" (click)="upload()">
              <span *ngIf="!loading">Upload</span>
              <span *ngIf="loading"><mat-spinner class="mx-auto" [diameter]="20" [strokeWidth]="3"></mat-spinner></span>
            </button>

            <button class="autoBtn secondary mx-3" (click)="cancel()">Cancel</button>
          </div>
        </form>
      </div>

      <div class="text-center" *ngIf="success">
        <h3>Success!</h3>

        <p>Your asset has successfully been uploaded.</p>

        <button class="autoBtn" (click)="reset()">Upload Another</button>

        <button class="autoBtn secondary mx-3" (click)="done()">Done</button>
      </div>
    </div>

    <div class="assetSelection">
      <div class="assetBox" *ngFor="let item of assetList" (mouseenter)="select(item._id)" (mouseleave)="select('')" (click)="select(item._id)">
        <div class="asset" *ngIf="!item.type || item.type === 'image'" [style.backgroundImage]="'url(' + item.path + ')'"></div>
        <div class="asset" *ngIf="item.type && item.type === 'video'" [style.backgroundImage]="'url(' + item.poster + ')'"><fa-icon [icon]="['fas', 'play-circle']" size="2x"></fa-icon></div>
        <div class="asset" *ngIf="item.type && item.type === 'file'">
            <a [href]="asset.path" target="_blank"><fa-icon [icon]="['fas', 'file']" size="2x"></fa-icon></a>
        </div>
        <div class="buttons" [@topDown]="true" *ngIf="this.assetId === item._id">
          <p class="disclaimer">{{ item.path }}</p>
          <div class="d-flex justify-content-center">
            <button class="btn" *ngIf="!item.type || item.type === 'image'" (click)="edit(item)"><fa-icon [icon]="['fas', 'edit']" size="2x"></fa-icon></button>
            <button class="btn" (click)="delete(item)"><fa-icon [icon]="['fas', 'trash-alt']" size="2x"></fa-icon></button>
          </div>
        </div>
      </div>
    </div>

    <mat-paginator [length]="totalLength" [pageSize]="pageSize" [pageIndex]="currentPage" [pageSizeOptions]="[12, 24, 48]" (page)="handlePage($event)"></mat-paginator>
  </div>
</section>
